<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Mytragor — Início</title>
  <style>
    /* Fantasy font (fallback to serif if unavailable) */
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;900&display=swap');
    :root{ --bg:#0b1020; --card:#0f1724; --gold1:#facc15; --gold2:#f59e0b; --muted:#9ca3af }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(180deg,#071025 0%,#04101a 100%);display:flex;align-items:center;justify-content:center;color:#e2e8f0}
    .wrap{width:100%;max-width:980px;padding:40px;box-sizing:border-box;display:flex;flex-direction:column;align-items:center}
  header{width:100%;display:flex;align-items:center;gap:12px;position:relative;padding:6px 0}
  /* Brand centered in the header using absolute positioning so login stays at the right */
  .brandWrap{position:absolute;left:50%;transform:translateX(-50%);top:18px;display:flex;flex-direction:column;align-items:center;pointer-events:none}
  .brand{font-family:'Cinzel', Georgia, 'Times New Roman', serif;color:var(--gold1);font-weight:900;font-size:42px;letter-spacing:2px;text-shadow:0 2px 0 rgba(0,0,0,.6), 0 6px 18px rgba(250,204,21,.12);margin:2px 0}
    /* shimmer-ready wrappers */
  .brand, .subtitle{position:relative;overflow:visible}
    .subtitle{font-family: Georgia, 'Times New Roman', serif;color:var(--gold1);font-size:14px;letter-spacing:1px;text-transform:uppercase;margin-top:6px;pointer-events:auto;text-shadow:0 1px 0 rgba(0,0,0,.45)}

    /* Subtle shimmer effect (soft moving highlight) */
    /* Instead of a rectangular streak, apply a text-clipped golden sheen so the highlight follows glyph shapes */
    .brand span, .subtitle span{
      display:inline-block;
      background: linear-gradient(90deg, rgba(255,235,160,0.06) 0%, rgba(255,250,200,0.95) 45%, rgba(255,230,140,0.95) 52%, rgba(255,215,90,0.6) 58%, rgba(255,235,160,0.06) 100%);
      background-size: 220% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: textShimmer 3.2s linear infinite;
    }

    /* golden outline / glow via layered text-shadow and -webkit-text-stroke when available */
    .brand{
      -webkit-text-stroke: 0.6px rgba(255,215,120,0.7);
      text-shadow: 0 1px 0 rgba(0,0,0,0.6), 0 4px 18px rgba(250,180,40,0.22), 0 0 10px rgba(255,215,120,0.12);
    }
    .subtitle{ text-shadow: 0 1px 0 rgba(0,0,0,0.45), 0 3px 10px rgba(250,190,60,0.14); }

    /* subtle magical sparks that FOLLOW the shimmer highlight.
       Implemented with a synchronized animation (same duration/timing
       as the text shimmer) so sparks travel with the bright band.
    */
    .brand .spark, .subtitle .spark{
      position:absolute;top:50%;left:0;width:9px;height:9px;border-radius:50%;pointer-events:none;
      background: radial-gradient(circle at 30% 30%, #fff 0%, #fff9d6 30%, rgba(255,210,80,0.98) 50%, rgba(255,210,80,0.22) 70%, transparent 85%);
      box-shadow:0 0 10px rgba(255,230,140,0.98),0 0 20px rgba(255,200,70,0.45);opacity:0;transform:translateY(-50%) scale(.6);
      mix-blend-mode: screen; animation: sparkFollow 3.2s linear infinite;
    }

    /* Spark follows same general timing as textShimmer (3.2s) so they appear to ride the gold sheen.
       We'll stagger multiple sparks with small delays (set below via nth-of-type).
    */
    @keyframes sparkFollow{
      0%   { left:-20%; opacity:0; transform:translateY(-50%) scale(.6); }
      12%  { left:12%;  opacity:1; transform:translateY(-50%) scale(.95); }
      35%  { left:45%;  opacity:0.95; transform:translateY(-50%) scale(1.05); }
      55%  { left:55%;  opacity:0.6; transform:translateY(-50%) scale(.95); }
      78%  { left:88%;  opacity:0.15; transform:translateY(-50%) scale(.8); }
      100% { left:120%; opacity:0; transform:translateY(-50%) scale(.6); }
    }

    /* small staggered delays per spark to create a natural trail */
    .brand .spark:nth-of-type(1){ animation-delay: 0s }
    .brand .spark:nth-of-type(2){ animation-delay: 0.12s }
    .brand .spark:nth-of-type(3){ animation-delay: 0.28s }

    .subtitle .spark{ width:7px; height:7px; box-shadow:0 0 8px rgba(255,230,140,0.9); }
    .subtitle .spark:nth-of-type(1){ animation-delay: 0.06s }
    .subtitle .spark:nth-of-type(2){ animation-delay: 0.18s }
    .subtitle .spark:nth-of-type(3){ animation-delay: 0.36s }

    @keyframes textShimmer{
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 200% 50%; }
    }
  .loginBtn{background:transparent;border:1px solid rgba(250,204,21,0.12);color:var(--gold1);padding:8px 14px;border-radius:10px;font-weight:700;cursor:pointer;margin-left:auto}
  .hero{width:100%;text-align:center;margin-top:84px}
  h1{display:none}
  p.lead{color:var(--muted);margin:20px 0 26px}

    .menu{width:320px;display:flex;flex-direction:column;gap:16px;margin:18px auto}
    .gold-btn{position:relative;display:block;text-decoration:none;text-align:center;padding:18px 20px;border-radius:12px;font-size:18px;font-weight:800;color:#111;box-shadow:0 6px 20px rgba(0,0,0,.45);border:0;cursor:pointer}
    .gold-btn.primary{background:linear-gradient(180deg,var(--gold1),var(--gold2));}
    .gold-btn.secondary{background:linear-gradient(180deg,rgba(250,204,21,0.2),rgba(250,204,21,0.07));color:var(--gold1);border:1px solid rgba(250,204,21,0.08)}
    .gold-btn:active{transform:translateY(1px)}

    /* ribbon/tarja "Em breve" */
    .gold-btn .ribbon{position:absolute;right:-10px;top:8px;background:#111;color:var(--gold1);font-weight:700;padding:6px 10px;border-radius:4px;transform:rotate(10deg);box-shadow:0 4px 18px rgba(0,0,0,.45);font-size:12px}
    .gold-btn.disabled{opacity:.9;pointer-events:none}

    /* make the button stack slightly larger on wide screens */
  @media(min-width:980px){ .menu{width:360px} .gold-btn{font-size:20px;padding:20px 24px} }
  @media(max-width:520px){ .brand{font-size:28px} .hero{margin-top:56px} }

    footer{margin-top:26px;color:var(--muted);font-size:13px}
    /* Medieval-style golden footer used on landing page */
    .footer-medieval{
      margin-top:26px;
      font-family: 'Cinzel', Georgia, 'Times New Roman', serif;
      color: var(--gold1);
      font-weight: 800;
      font-size:14px;
      letter-spacing:0.6px;
      text-shadow: 0 1px 0 rgba(0,0,0,0.6), 0 6px 18px rgba(250,204,21,0.12);
      text-align:center;
    }
  </style>
  <script>
    // Cache-bust local assets on page load so visitors get latest files.
    (function(){
      try{
        const v = 'v=' + Date.now();
        function addQ(el, attr){
          const url = el.getAttribute(attr);
          if(!url) return;
          if(/^(https?:|data:|file:|\/\/)/i.test(url)) return; // skip absolute/data URLs
          if(url.indexOf('?')>-1) el.setAttribute(attr, url + '&' + v); else el.setAttribute(attr, url + '?' + v);
        }
        // Bust local styles, scripts and common images
        document.querySelectorAll('link[rel=stylesheet], script[src], img').forEach(el=>{
          if(el.tagName==='LINK') addQ(el,'href'); else if(el.tagName==='SCRIPT') addQ(el,'src'); else addQ(el,'src');
        });
      }catch(e){console.warn('cache-bust failed',e)}
    })();
  </script>
  <!-- Firebase (compat) - used by the header auth modal when available -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Simple client-side account system with export/import and per-user deck storage.
    // Not a production auth system — provides portability via Export/Import.
    (function(){
      const USERS_KEY = 'mt_users';
      const CUR_KEY = 'mt_current_user';

      // Firebase configuration (kept in sync with client/src/firebase.js)
      const firebaseConfig = {
        apiKey: "AIzaSyAA3bgJmOzxq-oHe8ODjk-28gSLUtIpdFQ",
        authDomain: "mytragor-simulador.firebaseapp.com",
        projectId: "mytragor-simulador",
        storageBucket: "mytragor-simulador.firebasestorage.app",
        messagingSenderId: "1007200238881",
        appId: "1:1007200238881:web:4de615fe910e815e0f9260"
      };

      // Try to initialize Firebase (compat) if the scripts loaded successfully.
      try{
        if(window.firebase && firebase.initializeApp && !window._mytragor_firebase_init){
          firebase.initializeApp(firebaseConfig);
          window._mytragor_firebase_init = true;
          // keep UI in sync when auth state changes
          firebase.auth().onAuthStateChanged((u)=>{ try{ updateUserUI(); if(typeof renderModalState==='function') renderModalState(); }catch(e){} });
        }
      }catch(e){ console.warn('Firebase init failed (header modal):', e); }

      function loadUsers(){ try{ return JSON.parse(localStorage.getItem(USERS_KEY) || '[]'); }catch(e){ return []; } }
      function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }

      function toHex(buf){ return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join(''); }
      function fromHex(hex){ const bytes = new Uint8Array(hex.match(/.{1,2}/g).map(h=>parseInt(h,16))); return bytes; }

      async function derive(password, saltHex){
        const enc = new TextEncoder();
        const passKey = await crypto.subtle.importKey('raw', enc.encode(password), {name:'PBKDF2'}, false, ['deriveBits']);
        const salt = fromHex(saltHex);
        const bits = await crypto.subtle.deriveBits({name:'PBKDF2', salt, iterations: 120000, hash:'SHA-256'}, passKey, 256);
        return toHex(bits);
      }

      function genSaltHex(){ const a = crypto.getRandomValues(new Uint8Array(16)); return toHex(a); }

      // registerUser(email, password) - stores account locally (or via firebase) keyed by email
      async function registerUser(email, password){
        email = String(email||'').trim(); if(!email || !password) throw new Error('email/password required');
        // Prefer Firebase Auth when available
        if(window.firebase && firebase.auth){
          try{
            const res = await firebase.auth().createUserWithEmailAndPassword(email, password);
            // mirror minimal state locally (email used as key)
            localStorage.setItem(CUR_KEY, email);
            // ensure local users list has entry for this email
            const users = loadUsers(); if(!users.find(u=>u.email===email)){ users.push({ email, username: null, decks: [] }); saveUsers(users); }
            return { email, uid: res.user.uid };
          }catch(err){ throw err; }
        }
        // Fallback: localStorage-based account system
        const users = loadUsers(); if(users.find(u=>u.email===email)) throw new Error('email already registered');
        const salt = genSaltHex();
        const hash = await derive(password, salt);
        const user = { email, username: null, salt, hash, decks: [] };
        users.push(user); saveUsers(users); localStorage.setItem(CUR_KEY, email); return user;
      }

      // loginUser(email, password)
      async function loginUser(email, password){
        email = String(email||'').trim(); if(!email || !password) throw new Error('email/password required');
        // Prefer Firebase Auth when available
        if(window.firebase && firebase.auth){
          try{
            const res = await firebase.auth().signInWithEmailAndPassword(email, password);
            localStorage.setItem(CUR_KEY, email);
            // ensure local user record exists
            const users = loadUsers(); if(!users.find(u=>u.email===email)){ users.push({ email, username: null, decks: [] }); saveUsers(users); }
            return { email, uid: res.user.uid };
          }catch(err){ throw err; }
        }
        // Fallback: localStorage-based login (by email)
        const users = loadUsers(); const u = users.find(x=>x.email===String(email||'')); if(!u) throw new Error('user not found');
        const h = await derive(password, u.salt); if(h !== u.hash) throw new Error('invalid password');
        localStorage.setItem(CUR_KEY, u.email); return u;
      }

      function logoutUser(){
        if(window.firebase && firebase.auth){ try{ firebase.auth().signOut(); }catch(e){} }
        localStorage.removeItem(CUR_KEY);
      }
      function getCurrentUsername(){
        try{
          // determine current email (firebase or local)
          let email = null;
          if(window.firebase && firebase.auth && firebase.auth().currentUser){
            email = firebase.auth().currentUser.email || localStorage.getItem(CUR_KEY) || null;
          } else {
            email = localStorage.getItem(CUR_KEY) || null;
          }
          if(email){
            const mapped = getGameUsernameForEmail(email);
            if(mapped) return mapped;
            // fallback to firebase displayName if present
            try{ if(window.firebase && firebase.auth && firebase.auth().currentUser){ const d = firebase.auth().currentUser.displayName; if(d) return d; } }catch(e){}
            // fallback to local-part of email
            return String(email).split('@')[0];
          }
        }catch(e){ /* ignore */ }
        return null;
      }

  function getUserObjByEmail(email){ const users = loadUsers(); return users.find(u=>u.email===email) || null; }
  function saveUserObj(user){ const users = loadUsers(); const idx = users.findIndex(u=>u.email===user.email); if(idx>=0) users[idx]=user; else users.push(user); saveUsers(users); }

  function getUserDecks(){ const email = getCurrentEmail(); if(!email) return null; const u = getUserObjByEmail(email); return u ? (u.decks || []) : []; }
  function saveUserDecks(decks){ const email = getCurrentEmail(); if(!email) return false; const u = getUserObjByEmail(email); if(!u) return false; u.decks = decks; saveUserObj(u); return true; }

  // username mapping (local only): associate an email -> game username
  function getGameUsernameForEmail(email){ const u = getUserObjByEmail(email); return u ? (u.username || null) : null; }
  function isGameUsernameTaken(name){ if(!name) return false; const users = loadUsers(); const key = String(name).toLowerCase(); return users.some(u=>u.username && u.username.toLowerCase()===key); }
  function setGameUsernameForEmail(email, name){ const users = loadUsers(); const idx = users.findIndex(u=>u.email===email); if(idx<0) return false; users[idx].username = name; saveUsers(users); return true; }
  function getCurrentEmail(){ return localStorage.getItem(CUR_KEY) || null; }

      function exportAccount(){ const name = getCurrentUsername(); if(!name) throw new Error('no user'); const u = getUserObj(name); if(!u) throw new Error('no user'); return JSON.stringify(u); }
      function importAccount(json){ try{ const obj = typeof json==='string'? JSON.parse(json): json; if(!obj.username || !obj.hash) throw new Error('invalid'); const users = loadUsers(); const existing = users.find(u=>u.username===obj.username); if(existing){ // merge decks
          existing.decks = Array.from(new Set([...(existing.decks||[]), ...(obj.decks||[])]));
        } else { users.push(obj); }
        saveUsers(users); return true; }catch(e){ throw e; } }

      window.Auth = {
        register: registerUser,
        login: loginUser,
        logout: logoutUser,
        currentUser: getCurrentUsername,
        getUserDecks, saveUserDecks,
        exportAccount, importAccount
      };

      // UI wiring for the header auth button and a small modal
      function updateUserUI(){ const el = document.getElementById('userStatus'); const btn = document.getElementById('btnUserAuth'); if(!el||!btn) return; const u = window.Auth.currentUser(); if(u){ el.textContent = u; btn.textContent='Conta'; } else { el.textContent = ''; btn.textContent='Entrar / Conta'; } }

      function makeAuthModal(){
        if(document.getElementById('userAuthModal')) return;
        const modal = document.createElement('div');
        modal.id='userAuthModal'; modal.className='mp-modal'; modal.style.display='none';
        modal.setAttribute('role','dialog'); modal.setAttribute('aria-modal','true');

        modal.innerHTML = `
          <div class="mp-card mp-modal-card" role="document" tabindex="0" aria-labelledby="authTitle">
            <div class="mp-header" style="align-items:center;gap:12px;padding:14px 16px;">
              <div style="display:flex;align-items:center;gap:12px">
                <div id="authAvatar" style="width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,rgba(250,204,21,0.12),rgba(245,158,11,0.06));display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--gold1);font-size:18px">?</div>
                <div>
                  <div class="mp-title" id="authTitle" style="font-size:16px;color:var(--gold1)">Conta Mytragor</div>
                  <div id="authSub" style="font-size:12px;color:var(--muted);margin-top:2px">Entrar, registrar ou exportar sua conta</div>
                </div>
              </div>
              <div class="mp-actions"><button id="closeUserAuth" class="mp-btn ghost" aria-label="Fechar">Fechar</button></div>
            </div>
            <div class="mp-body" style="display:grid;grid-template-columns:1fr 220px;gap:14px;padding:18px;">
              <div>
                <div id="authMsg" style="margin-bottom:10px;color:#9ca3af;font-size:13px"></div>
                <div class="mp-row"><label class="mp-label" for="auEmail">Email</label><input id="auEmail" class="mp-input" type="email" placeholder="seu@exemplo.com"></div>
                <div class="mp-row"><label class="mp-label" for="auPass">Senha</label><input id="auPass" class="mp-input" type="password" placeholder="senha"></div>
                <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
                  <button id="btnAuthRegister" class="mp-btn" title="Criar nova conta">Criar conta</button>
                  <button id="btnAuthLogin" class="mp-btn primary" title="Entrar">Entrar</button>
                </div>
              </div>
              <aside style="padding:10px;border-left:1px dashed rgba(255,255,255,0.03);">
                <div style="font-weight:800;color:var(--gold1);margin-bottom:8px">Vantagens</div>
                <ul style="margin:0 0 12px 18px;color:var(--muted);font-size:13px">
                  <li>Salvar decks em sua conta</li>
                  <li>Exportar/Importar conta</li>
                  <li>Sincronização futura (opcional)</li>
                </ul>
                <div style="display:flex;flex-direction:column;gap:8px;margin-top:6px">
                  <button id="btnExportAcc" class="mp-btn">Exportar conta</button>
                  <button id="btnImportAcc" class="mp-btn">Importar conta</button>
                  <button id="btnLogout" class="mp-btn ghost" style="display:none">Desconectar</button>
                </div>
                <div id="deckCount" style="margin-top:12px;color:var(--muted);font-size:13px"></div>
              </aside>
            </div>
          </div>`;

        document.body.appendChild(modal);

        const closeBtn = document.getElementById('closeUserAuth');
        closeBtn.addEventListener('click', ()=>{ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; });

        async function doRegister(){
          const email = document.getElementById('auEmail').value.trim(); const p = document.getElementById('auPass').value;
          const msg = document.getElementById('authMsg'); msg.textContent='';
          try{ await window.Auth.register(email,p); msg.style.color='#86efac'; msg.textContent='Registrado e logado.'; updateUserUI(); renderModalState(); // after register, prompt for game username if needed
            setTimeout(()=>{ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; checkPostLogin(email); },700);
          }catch(e){ msg.style.color='#fca3a5'; msg.textContent = (e && e.message) || 'erro'; }
        }

        async function doLogin(){
          const email = document.getElementById('auEmail').value.trim(); const p = document.getElementById('auPass').value; const msg = document.getElementById('authMsg'); msg.textContent=''; try{ await window.Auth.login(email,p); msg.style.color='#86efac'; msg.textContent='Logado.'; updateUserUI(); renderModalState(); setTimeout(()=>{ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; checkPostLogin(email); },400); }catch(e){ msg.style.color='#fca5a5'; msg.textContent = e.message || 'erro'; }
        }

        document.getElementById('btnAuthRegister').addEventListener('click', doRegister);
        document.getElementById('btnAuthLogin').addEventListener('click', doLogin);

        document.getElementById('btnExportAcc').addEventListener('click', ()=>{
          try{ const data = window.Auth.exportAccount(); const w = window.open(); w.document.title = 'Export — Mytragor'; w.document.body.style.fontFamily='monospace'; w.document.write('<pre>'+escapeHtml(data)+'</pre>'); }catch(e){ alert('Erro: ' + (e.message||e)); }
        });

        document.getElementById('btnImportAcc').addEventListener('click', ()=>{
          const raw = prompt('Cole aqui o JSON exportado da conta:'); if(!raw) return; try{ window.Auth.importAccount(raw); alert('Conta importada.'); renderModalState(); }catch(e){ alert('Import falhou: '+(e.message||e)); }
        });

        document.getElementById('btnLogout').addEventListener('click', ()=>{
          window.Auth.logout(); updateUserUI(); renderModalState();
        });

        // Submit on Enter when focused in inputs (default to login)
        modal.addEventListener('keydown', (ev)=>{
          if(ev.key === 'Enter'){
            const tgt = ev.target; if(tgt && (tgt.tagName==='INPUT' || tgt.tagName==='TEXTAREA')){ ev.preventDefault(); doLogin(); }
          }
        });

        function renderModalState(){
            const display = window.Auth.currentUser(); const avatar = document.getElementById('authAvatar'); const sub = document.getElementById('authSub'); const logout = document.getElementById('btnLogout'); const deckCount = document.getElementById('deckCount'); const auEmail = document.getElementById('auEmail'); const auPass = document.getElementById('auPass'); const msg = document.getElementById('authMsg'); msg.textContent='';
            if(display){ avatar.textContent = (display[0]||'?').toUpperCase(); sub.textContent = 'Logado como ' + display; logout.style.display='inline-block'; if(auEmail) auEmail.value = getCurrentEmail() || ''; if(auPass) auPass.value = '';
              const decks = window.Auth.getUserDecks() || []; deckCount.textContent = 'Decks salvos: ' + decks.length;
            } else { avatar.textContent = '?'; sub.textContent = 'Entrar, registrar ou exportar sua conta'; logout.style.display='none'; deckCount.textContent = ''; if(auEmail) auEmail.value = ''; if(auPass) auPass.value = ''; }
          }

        renderModalState();
        // helper to open username chooser after login if needed
        async function checkPostLogin(email){
          try{
            const mapped = getGameUsernameForEmail(email);
            if(!mapped){
              // open a lightweight modal to choose username (local only)
              openChooseUsernameModal(email);
            } else {
              // update UI to show mapped name
              updateUserUI();
            }
          }catch(e){ console.warn('checkPostLogin failed',e); }
        }

        function openChooseUsernameModal(email){
          if(document.getElementById('chooseUsernameModal')) return;
          const modal = document.createElement('div'); modal.id='chooseUsernameModal'; modal.className='mp-modal'; modal.style.display='flex'; modal.setAttribute('role','dialog'); modal.setAttribute('aria-modal','true');
          modal.innerHTML = `
            <div class="mp-card mp-modal-card" role="document" tabindex="0">
              <div class="mp-header" style="align-items:center;gap:12px;padding:14px 16px;">
                <div style="display:flex;align-items:center;gap:12px">
                  <div style="font-weight:800;color:var(--gold1);">Escolha seu nome no jogo</div>
                </div>
                <div class="mp-actions"><button id="closeChooseUsername" class="mp-btn ghost">Fechar</button></div>
              </div>
              <div class="mp-body" style="padding:16px;">
                <div style="margin-bottom:8px;color:var(--muted);font-size:13px">Este nome será exibido apenas dentro do jogo. Não pode ser usado por outro jogador neste navegador.</div>
                <div class="mp-row"><label class="mp-label" for="gameUsername">Nome de usuário</label><input id="gameUsername" class="mp-input" type="text" placeholder="ex: Jogador1"></div>
                <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;"><button id="btnSaveGameUsername" class="mp-btn primary">Salvar</button></div>
              </div>
            </div>`;
          document.body.appendChild(modal);
          document.getElementById('closeChooseUsername').addEventListener('click', ()=>{ modal.remove(); document.body.style.overflow=''; });
          document.getElementById('btnSaveGameUsername').addEventListener('click', ()=>{
            const name = document.getElementById('gameUsername').value.trim(); const msg = document.getElementById('authMsg');
            if(!name || name.length < 3 || name.length > 24){ alert('Nome inválido: use entre 3 e 24 caracteres.'); return; }
            if(isGameUsernameTaken(name)){ alert('Nome já em uso neste navegador. Escolha outro.'); return; }
            setGameUsernameForEmail(email, name);
            updateUserUI();
            modal.remove(); document.body.style.overflow='';
          });
          // focus input
          setTimeout(()=>{ const el = document.getElementById('gameUsername'); if(el) el.focus(); },80);
        }
      }

      function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

      document.addEventListener('DOMContentLoaded', ()=>{
        updateUserUI(); makeAuthModal();
        const btn = document.getElementById('btnUserAuth'); const modal = document.getElementById('userAuthModal');
        if(btn && modal){ btn.addEventListener('click', ()=>{ modal.style.display='flex'; modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }); }
      });
    })();
  </script>
  <!-- Inline modal styles (polished, accessible) -->
  <style>
    /* Overlay */
    .mp-modal {
      position: fixed;
      inset: 0;
      display: none; /* toggled inline by JS (keeps behavior) */
      align-items: center;
      justify-content: center;
      background: rgba(2,6,23,0.62);
      z-index: 10000;
      padding: 20px;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      backdrop-filter: blur(6px) saturate(1.03);
    }

    /* Card: translucent 'glass' with subtle golden frame and glow */
    .mp-card.mp-modal-card {
      width: 360px;
      max-width: 92vw;
      background: linear-gradient(180deg, rgba(12,14,18,0.82), rgba(6,7,10,0.66));
      border-radius: 14px;
      border: 1px solid rgba(250,204,21,0.14);
      box-shadow: 0 20px 48px rgba(2,6,23,0.88), 0 0 34px rgba(250,204,21,0.06);
      overflow: hidden;
      transition: transform .18s cubic-bezier(.2,.9,.25,1), box-shadow .18s ease, opacity .12s ease;
      transform-origin: center;
    }

    /* Slight lift when opened for perception of depth */
    .mp-modal[aria-hidden="false"] .mp-card.mp-modal-card,
    .mp-modal[style*="display:flex"] .mp-card.mp-modal-card {
      transform: translateY(-6px) scale(1.01);
    }

    /* Header */
    #mpLoginModal .mp-header { 
      display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.03); 
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0));
    }
    #mpLoginModal .mp-title{font-weight:800;color:var(--gold1,#facc15);letter-spacing:.6px}

    /* Body */
    #mpLoginModal .mp-body { padding:18px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06)); }

    /* Inputs */
    .mp-input { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background: rgba(0,0,0,0.28); color: #e6eef8; }
    .mp-input::placeholder{ color: rgba(230,238,248,0.42); }
    .mp-input:focus { outline: none; box-shadow: 0 0 0 4px rgba(250,204,21,0.10); border-color: rgba(250,204,21,0.28); }

    /* Buttons */
    .mp-btn { padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02); background: rgba(12,18,30,0.6); color:#e6eef8; font-weight:700; }
    .mp-btn.ghost{ background: transparent; color: rgba(230,230,230,0.78); border:1px solid rgba(255,255,255,0.03); }
    .mp-btn.primary{ background: linear-gradient(180deg, rgba(250,204,21,0.95), rgba(245,158,11,0.95)); color:#111; border: 1px solid rgba(250,170,25,0.95); box-shadow: 0 8px 22px rgba(250,180,40,0.08); }
    .mp-btn.primary:hover{ transform: translateY(-2px); }
    .mp-btn:focus{ box-shadow: 0 0 0 4px rgba(250,204,21,0.12); }

    /* Small layout helpers */
    .mp-actions .mp-btn{ padding:8px 10px }
    #mpLoginModal .mp-row{ margin-bottom:8px }

    /* Accessible focus ring for keyboard users */
    .mp-card:focus { outline: none; box-shadow: 0 0 0 6px rgba(250,204,21,0.06); }

    /* Close button visual tweak */
    #mpCloseBtn{ background: transparent; border: none; color: rgba(230,230,230,0.8); font-weight:700; padding:6px 8px; border-radius:8px }
    #mpCloseBtn:hover{ background: rgba(255,255,255,0.02) }

    /* Ensure the small registration inline modal inherits these styles too */
    .mp-card { -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px); }
  </style>
  <style>
    /* Header auth button (prominent) */
    .auth-btn{ display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:12px;font-weight:800;background:linear-gradient(180deg,var(--gold1),var(--gold2));color:#111;border:1px solid rgba(250,170,25,0.95);box-shadow:0 8px 26px rgba(250,170,25,0.12); }
    .auth-icon{ width:18px;height:18px;flex:0 0 18px;color:#1b1b1b;filter:drop-shadow(0 6px 18px rgba(250,170,25,0.08)); }
    .auth-label{ font-weight:800; color:#111; letter-spacing:0.4px }
    .auth-btn:hover{ transform: translateY(-3px) scale(1.02); box-shadow:0 14px 44px rgba(250,170,25,0.16); }
    .auth-btn:active{ transform: translateY(0) scale(0.998); }
    .auth-btn:focus{ box-shadow: 0 0 0 8px rgba(250,204,21,0.12); outline:none }
    @media(max-width:520px){ .auth-label{ display:none } .auth-btn{ padding:8px;border-radius:10px } }
  </style>
  <link rel="stylesheet" href="assets/mobile.css" media="(max-width:880px)">
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brandWrap" aria-hidden="false">
        <div class="brand"><span>Mytragor</span>
            <i class="spark" aria-hidden="true"></i>
            <i class="spark" aria-hidden="true"></i>
            <i class="spark" aria-hidden="true"></i>
        </div>
          <div class="subtitle"><span>Trading card game</span>
            <i class="spark" aria-hidden="true"></i>
            <i class="spark" aria-hidden="true"></i>
            <i class="spark" aria-hidden="true"></i>
          </div>
  </div>
    </header>
    <div style="position:absolute;right:18px;top:18px;display:flex;gap:8px;align-items:center">
      <div id="userStatus" style="color:#cbd5e1;font-weight:700"></div>
  <button id="btnUserAuth" class="mp-btn auth-btn" aria-haspopup="dialog" aria-controls="userAuthModal">
        <svg class="auth-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 12c2.761 0 5-2.239 5-5s-2.239-5-5-5-5 2.239-5 5 2.239 5 5 5z" fill="currentColor" opacity="0.95"/>
          <path d="M4 20c0-3.866 3.582-7 8-7s8 3.134 8 7v1H4v-1z" fill="currentColor" opacity="0.9"/>
        </svg>
        <span class="auth-label">Entrar / Conta</span>
      </button>
    </div>

    <main class="hero">
      <h1>Mytragor — Simulador</h1>
      <p class="lead">Escolha uma opção para começar</p>

      <nav class="menu" aria-label="Menu principal">
  <a class="gold-btn primary disabled" href="#" id="btnMultiplayer" aria-disabled="true" title="Multiplayer (desabilitado)">Multiplayer <span class="ribbon">Em breve</span></a>
        <a class="gold-btn primary" id="btnVsAI" href="mytragor_simulador.html">VS IA</a>
        <a class="gold-btn primary" id="btnDeckBuilder" href="assets/ui/deckbuilder.html">Montar Deck</a>
  <a class="gold-btn primary" id="btnGallery" href="gallery.html">Galeria</a>
      </nav>
      <!-- Quick test buttons: open simulator as p1 or p2 in room 123 -->
  <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
     <footer class="footer-medieval">do RPG de mesa para o Trading Card Game. Rola o D20.</footer>
    </main>
  </div>

  <!-- Multiplayer Login Modal -->
  <div id="mpLoginModal" class="mp-modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="mpLoginTitle" aria-describedby="mpLoginDesc">
    <div class="mp-card mp-modal-card" role="document" aria-labelledby="mpLoginTitle" tabindex="0">
      <div class="mp-header mp-draggable">
        <div class="mp-title" id="mpLoginTitle">Login Multiplayer</div>
        <div class="mp-actions"><button id="mpCloseBtn" class="mp-btn ghost" type="button" aria-label="Fechar" title="Fechar diálogo">Sair</button></div>
      </div>
      <div class="mp-body">
        <div id="mpLoginDesc" class="mp-tip" style="margin-bottom:6px;color:var(--mp-ink-dim);font-size:13px">Configurar conexão multiplayer e entrar na sala.</div>
        <div class="mp-row">
          <label class="mp-label" for="mpServer">Servidor WS</label>
          <input id="mpServer" class="mp-input" type="text" placeholder="ws://localhost:8080" value="" />
        </div>
        <div class="mp-row">
          <label class="mp-label" for="mpRoom">Código da sala</label>
          <input id="mpRoom" class="mp-input" type="text" placeholder="TESTE123" value="TESTE123" />
        </div>
        <div class="mp-row">
          <label class="mp-label" for="mpSide">Lado</label>
          <select id="mpSide" class="mp-input">
            <option value="p1">p1 (Jogador 1)</option>
            <option value="p2">p2 (Jogador 2)</option>
          </select>
        </div>
        <div style="display:flex;gap:10px;justify-content:space-between;margin-top:8px;">
          <button id="mpRegisterBtn" class="mp-btn">Cadastre-se</button>
          <div style="flex:1"></div>
          <button id="mpLoginSubmit" class="mp-btn primary">Entrar na Sala</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Show the multiplayer login modal (accessible): toggle aria-hidden, trap focus lightly
    function showMpLogin(){
      const m = document.getElementById('mpLoginModal');
      if(!m) return;
      m.style.display = 'flex';
      m.setAttribute('aria-hidden','false');
      // prevent background scroll while modal open
      document.body.style.overflow = 'hidden';
      // focus the card then the first field for better a11y
      const card = m.querySelector('.mp-card'); if(card) card.focus();
      setTimeout(()=>{ const u = document.getElementById('mpUser'); if(u) u.focus(); }, 80);
    }
    function hideMpLogin(){
      const m = document.getElementById('mpLoginModal'); if(!m) return;
      m.style.display = 'none';
      m.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }
    
    // Note: login button removed from header to avoid duplicate prompts.
    document.getElementById('mpCloseBtn').addEventListener('click', hideMpLogin);
    document.getElementById('mpRegisterBtn').addEventListener('click', ()=>{
      // Create a proper modal wrapper so it inherits the same styles as the login modal
      const regWrap = document.createElement('div');
      regWrap.id = 'mpRegisterModal';
      regWrap.className = 'mp-modal';
      regWrap.setAttribute('role','dialog');
      regWrap.setAttribute('aria-modal','true');
      regWrap.setAttribute('aria-labelledby','regTitle');
      regWrap.style.zIndex = '11000';

      regWrap.innerHTML = `
        <div class="mp-card mp-modal-card" role="document" tabindex="0">
          <div class="mp-header"><div class="mp-title" id="regTitle">Cadastre-se</div><div class="mp-actions"><button id="regClose" class="mp-btn ghost" aria-label="Fechar">Sair</button></div></div>
          <div class="mp-body">
            <div class="mp-row"><label class="mp-label" for="regUser">Usuário</label><input id="regUser" class="mp-input" type="text" placeholder="Nome de usuário"></div>
            <div class="mp-row"><label class="mp-label" for="regPass">Senha</label><input id="regPass" class="mp-input" type="password" placeholder="Senha"></div>
            <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:8px;"><button id="regSubmit" class="mp-btn primary">Registrar</button></div>
          </div>
        </div>
      `;

      document.body.appendChild(regWrap);
      // show (it'll match modal visuals via .mp-modal)
      regWrap.style.display = 'flex';
      regWrap.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      // focus first field
      setTimeout(()=>{ const u = document.getElementById('regUser'); if(u) u.focus(); }, 60);

      // Wire the close and submit handlers for this dynamically created modal
  document.getElementById('regClose').addEventListener('click', ()=>{ regWrap.remove(); document.body.style.overflow = ''; const el=document.getElementById('mpServer'); if(el) el.focus(); });
      document.getElementById('regSubmit').addEventListener('click', ()=>{
        const u = document.getElementById('regUser').value.trim();
        const p = document.getElementById('regPass').value;
        if(!u){ alert('Informe um nome de usuário.'); return; }
        // Stub: accept registration, close modal and prefill login
        alert('Registrado (simulado): ' + u);
        regWrap.remove();
        document.body.style.overflow = '';
        const loginUser = document.getElementById('mpUser'); if(loginUser) loginUser.value = u;
      });
    });

    document.getElementById('mpLoginSubmit').addEventListener('click', ()=>{
      // gather values from the modal and navigate to the simulator in MP mode
      const server = (document.getElementById('mpServer').value || localStorage.getItem('mpServer') || 'ws://localhost:8080').trim();
      const sala = (document.getElementById('mpRoom').value || 'TESTE123').trim();
      const lado = (document.getElementById('mpSide').value === 'p2') ? 'p2' : 'p1';
      localStorage.setItem('mpServer', server);
      hideMpLogin();
      const url = new URL(location.href);
      const base = url.pathname.endsWith('/')
        ? url.pathname
        : url.pathname.substring(0, url.pathname.lastIndexOf('/') + 1);
      url.pathname = base + 'mytragor_simulador.html';
      url.searchParams.set('mode','mp');
      url.searchParams.set('room', sala);
      url.searchParams.set('side', lado);
      location.href = url.toString();
    });

    // Extra: keyboard shortcuts (ignore when typing in inputs/textareas/contenteditable)
    document.addEventListener('keydown', (e)=>{
      try{
        const tgt = e.target || document.activeElement;
        const tag = (tgt && tgt.tagName) ? tgt.tagName.toUpperCase() : '';
        if(tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT' || (tgt && tgt.isContentEditable)) return; // user is typing
      }catch(_){ /* ignore */ }
      if(e.key === '1') location.href = 'mytragor_simulador.html';
      if(e.key === '2') location.href = 'assets/ui/deckbuilder.html';
    });
  </script>

  <!-- Multiplayer client -->
  <script src="net/net.js"></script>
  <script>
    async function abrirMultiplayer() {
      // 1) configurar servidor (guarda uma vez)
      let server = localStorage.getItem('mpServer') || 'ws://localhost:8080';
      server = prompt('Servidor WS:', server) || server;
      localStorage.setItem('mpServer', server);

      // 2) escolher sala e lado
      const sala = prompt('Código da sala:', 'TESTE123') || 'TESTE123';
      const lado = prompt('Lado (p1 ou p2):', 'p1') === 'p2' ? 'p2' : 'p1';

    // 3) abrir a página do simulador com a querystring
    const url = new URL(location.href);
    const base = url.pathname.endsWith('/')
      ? url.pathname
      : url.pathname.substring(0, url.pathname.lastIndexOf('/') + 1);
    url.pathname = base + 'mytragor_simulador.html';
    url.searchParams.set('mode', 'mp');
    url.searchParams.set('room', sala);
    url.searchParams.set('side', lado);
    location.href = url.toString();
    }

  // ligar o botão Multiplayer -> abrir modal de configuração
  const mpBtn = document.getElementById('btnMultiplayer');
  if (mpBtn) {
    // Do not attach multiplayer navigation while feature is not ready
    const isDisabled = mpBtn.classList.contains('disabled') || mpBtn.getAttribute('aria-disabled') === 'true';
    if (!isDisabled) {
      mpBtn.addEventListener('click', (e) => { e.preventDefault(); location.href = 'multiplayer.html'; });
    } else {
      // ensure it doesn't navigate if clicked programmatically
      mpBtn.addEventListener('click', (e) => { e.preventDefault(); });
      mpBtn.style.cursor = 'default';
    }
  }
  // quick debug buttons to open simulator directly as p1/p2 in room 123
  const btnP1 = document.getElementById('btnP1');
  const btnP2 = document.getElementById('btnP2');
  if(btnP1) btnP1.onclick = () => { location.search = '?mode=mp&room=123&side=p1'; };
  if(btnP2) btnP2.onclick = () => { location.search = '?mode=mp&room=123&side=p2'; };

    // boot automático do cliente quando a página está com ?mode=mp
    (function autoStartMP() {
      const u = new URL(location.href);
      if (u.searchParams.get('mode') === 'mp') {
        if (!window.Net) { console.error('net.js não carregado'); return; }
        window.Net.start();
        // opcional: esconder o lado adversário ou refletir o tabuleiro
        document.body.classList.add('is-mp');
      }
    })();
  </script>
  <script src="assets/mobile.js"></script>
</body>
</html>